{% extends "layout.html" %}

{% block smallheader %}
    <div class="text-left logo" style="background-color:#cccccc;padding:10px;">
		<img src="{{ url_for('static', filename='dafd/img/dafd-logo-2.png') }}" width="15%"/>
	</div>
    {% endblock %}
    <hr/>
    
{%  block content %}
                
<!-- page content -->

<div class="d-flex align-items-center justify-content-center min-vh-100">
    <div class="container">
        
        <form action="{{ url_for('nn.run') }}" method='post'>

            <div class="row">

				<div class="col-md-1"></div>
                <div class="col-md-10" border=1>
                    <h3 class="title">Data Summary</h3>
                    <div>
                        <label><b>Dataset name:</b></label>
                        <input type='text' name='filename' value='{{ filename }}' readonly/>
                        <label><b>Model name (required):</b></label>
                        <input size=30 type='text' id='reqParam0' name='model-name' value='{{ model_name }}'/>
                    </div>

                    <!--<div id="container"></div>-->

                    <input type='submit' name='submit' value='Classification' class="btn btn-success run"/>
                    <input type='submit' name='submit' value='Regression' class="btn btn-success run"/>

                    <br/>
                    <table id="summary" border=1>
                        <tr>
                            <th>target variable</th>
                            <th>drop?</th>
                            {% for column in columns %}
                                <th>{{column}}</th>
                            {% endfor %}
                        </tr>
                        {% for row in data %}
                        <tr>
                            <td><span class='targetVar'><input type='checkbox' name='target' value='{{row[0]}}'/></span></td>
                            <td><input type='checkbox' name='drop' value='{{row[0]}}'/></td>
                            {% for col in row %}
                                {% if loop.index==3 %}
                                    {% if col==0 %}
                                        <td></td>
                                    {% elif col==1 %}
                                        <td>
                                            <select name='todo_datetime'>
                                                <!--<option value='drop' selected>Drop</option>-->
                                                <option value='category'>To Categorical</option>
                                                <option value='factorize'>Factorize</option>
                                            </select>
                                        </td>
                                    {% elif col==2 %}
                                        <td>
                                            <select name='todo_text'>
                                                <!--<option value='drop' selected>Drop</option>-->
                                                <option value='category'>To Categorical</option>
                                            </select>
                                        </td>
                                    {% endif %}
                                {% else %}
                                    <td>{{col}}</td>
                                {% endif %}
                        {% endfor %}
                        </tr>
                        {% endfor %}
                    </table>

                    
                    <h3 style='padding-bottom:10px;padding-top:10px'>Advanced Settings</h3>
                    <div>
                        <p>Label encoding:</p>
                        <label><input type='radio' name='encoding' value='label'/>Label Encoding</label>
                        <label><input type='radio' name='encoding' value='onehot'/>One Hot Encoding</label>
                        <label><input type='radio' name='encoding' value='none' checked/>None</label>
                    </div>
                    <div>
                        <p>Data normalization:</p>
                        <label><input type='radio' name='normalization' value='minmax' checked/>Min-Max Scaler</label>
                        <label><input type='radio' name='normalization' value='standard'/>Standard Scaler</label>
                        <label><input type='radio' name='normalization' value='robust'/>Robust Scaler</label>
                        <label><input type='radio' name='normalization' value='none'/>None</label>
                    </div>
                    <div>
                        <p>Missing values:</p>
                        <label><input type='radio' name='missing' value='drop' checked/>Dropping</label>
                        <label><input type='radio' name='missing' value='mean'/>Mean-Impute</label>
                        <label><input type='radio' name='missing' value='median'/>Median-Impute</label>
                        <label><input type='radio' name='missing' value='most_frequent'/>Mode-Impute</label>
                    </div>
                    <div>
                        <label>Test size: <input type='text' name='test-size' value='0.2'/></label>
                    </div>
                    <div>
                        <label><input type='checkbox' name='crossval' value='crossval'/>Cross Validation</label><br/>
                        <label><input type='radio' name='cv_method' value='kfold' checked/>K-Fold</label>
                        <label><input type='radio' name='cv_method' value='loo'/>Leave-One-Out</label>
                        <label><input type='radio' name='cv_method' value='stratkfold'/>Stratified K-Fold</label>
                    </div>
                    <div>
                        <label><input type='checkbox' name='dim_red' value='dim_red'/>Dimension reduction (number of new dimensions):</label>
                        <input type='text' name='dimension' value=''/>
                    </div>
                    <div>
                        <label><input type='checkbox' id='hyperpars' name='hyper-param' value='hyper-param'/>Hyperparameter Optimization:</label>
                        <label><input type='radio' name='tuning' value='grids' checked/>Grid Search</label>
                        <label><input type='radio' name='tuning' value='randoms'/>Random Search</label>
                        <label><input type='radio' name='tuning' value='bayesian'/>Bayesian Optimization</label>
                    </div>
                    <div>
                        <p>Classification metrics:</p>
                        <label><input type='checkbox' name='cls_metrics' value='accuracy' checked/>Accuracy</label>
                        <label><input type='checkbox' name='cls_metrics' value='precision'/>Precision</label>
                        <label><input type='checkbox' name='cls_metrics' value='recall'/>Recall</label>
                        <label><input type='checkbox' name='cls_metrics' value='f1'/>F1 Score</label>
                        <label><input type='checkbox' name='cls_metrics' value='roc_auc'/>ROC-AUC Score</label>
                        <!--<label><input type='checkbox' name='metrics' value='mcc' checked/>MCC</label>-->
                    </div>
                    <div>
                        <p>Regression metrics:</p>
                        <label><input type='checkbox' name='reg_metrics' value='r2' checked/>R^2</label>
                        <label><input type='checkbox' name='reg_metrics' value='mae'/>MAE</label>
                        <label><input type='checkbox' name='reg_metrics' value='mse'/>MSE</label>
                        <label><input type='checkbox' name='reg_metrics' value='rmse'/>RMSE</label>
                    </div>

                    <h3 style='padding-bottom:10px;padding-top:10px'>Neural-Network Settings</h3>
                    <div>Split with comma (,) for multiple values for each parameter</div>
                    <div>
                        <label>Epoch:</label>
                        <input id='reqParam1' type='text' name='epoch' value='32'/>
                    </div>
                    <div>
                        <label>Batch-Size:</label>
                        <input id='reqParam2' type='text' name='batch' value='100'/>
                    </div>
                    <div>
                        <label>Number of Hidden Layers:</label>
                        <input id='reqParam3' type='text' name='num_layers' value='8'/>
                    </div>
                    <div>
                        <label>Number of Nodes per Layer:</label>
                        <input id='reqParam4' type='text' name='num_nodes' value='8'/>
                    </div>
                </div>
				<div class="col-md-1"></div>
            </div>
        </form>
    </div>
</div>
<!-- /page content -->
{% endblock %}

{% block add_script %}
<script>
    $('.run').on('click', function() {
        var checked = $('.targetVar').find(':checked').length;
        if (!checked) {
            alert('No target selected. Please pick your target variable!');
            event.preventDefault();
        }
        else if (checked > 1) {
            //confirmation = confirm(checked + ' variables are checked! Run multi-label task?');
            //if (!confirmation)
             //   event.preventDefault();
            alert('Multi-label is not supported at the moment. Please pick one target variable!');
            event.preventDefault();
        }

        var tune = document.getElementById('hyperpars').checked
        var m = document.getElementById('reqParam0').value
        var a = document.getElementById('reqParam1').value
        var b = document.getElementById('reqParam2').value
        var c = document.getElementById('reqParam3').value
        var d = document.getElementById('reqParam4').value


        if (m == null || m == "") {
            alert("Please fill the model name!");
            event.preventDefault();
        }

        //if (a == null || a == "", b == null || b == "", c == null || c == "", d == null || d == "") {
        if(tune) {

            if (a == null || a == "" || b == null || b == "" || c == null || c == "" || d == null || d == "") {
                //alert(document.getElementById('reqParam1').value)
                alert("Please fill all required fields (NN Parameters Setting)!");
                event.preventDefault();
            }
        }
    });
</script>
{% endblock %}
